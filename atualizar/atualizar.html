<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atualizar Livro</title>
    <link rel="icon" type="image/png" href="../hackimg.jpeg">

    <!-- CSS only -->
    <link rel="stylesheet" href="estilo.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
    
    <div class="container">
      <br>
        <h3>Atualização de Cadastro</h3>
        <div class="row" id="linha1">
            <div class="col-6">
                <label class="word1" for="validationCustom01">Email</label>
                <input type="text" class="form-control" id="txtemail" placeholder="Bruno@gmail.com" required>
                <div class="valid-feedback">
                  Tudo certo!
                </div>
              </div>
            <div class="col-6">
                <label class="word1"
                  for="inputPassword6">Senha</label>
                <input type="password" id="txtsenha" placeholder="********" class="form-control mx-sm-3" aria-describedby="passwordHelpInline">
                  <div class="invalid-feedback">
                    Deve ter entre 8 e 20 caracteres.
                  </div>
            </div>
        </div>
        <fieldset>
            <legend style="color: white;">Pessoal</legend>
        <div class="row" id="linha2">
            <div class="col-6">
                <label class="word1" for="validationCustom01">Primeiro nome</label>
                <input type="text" class="form-control" id="txtprimeironome" placeholder="Nome" onkeydown="return /[a-z]/i.test(event.key)" required>
                <div class="valid-feedback">
                  Tudo certo!
                </div>
              </div>
            <div class="col-6">
                <label class ="word1"for="validationCustom02">Sobrenome</label>
                <input type="text" class="form-control" id="txtsobrenome" placeholder="Sobrenome" onkeydown="return /[a-z]/i.test(event.key)" required>
                <div class="valid-feedback">
                  Tudo certo!
                </div>
            </div>
        </div>
        <div class="row" id="linha6">
              <div class="col-6">
                <label class="word1"for="validationCustomUsername">Usuário</label>
                <div class="input-group">
                  <div class="input-group-prepend">
                    <span class="input-group-text" id="usuário">@</span>
                  </div>
                  <input type="text" class="form-control" id="txtusuario" placeholder="Usuário" aria-describedby="inputGroupPrepend" required>
                  <div class="invalid-feedback">
                    Por favor, escolha um nome de usuário.
                  </div>
                </div>
              </div>
              <div class="col-6">
                <label class="word1" for="validationCustom01">Telefone</label>
                <input type="text" class="form-control" id="txttelefone" placeholder="Telefone" onkeypress="$(this).mask('(00) 00000-0000');" required>
                <div class="valid-feedback">
                  Tudo certo!
                </div>
              </div>
        </div>
        <br>
        <div class="row" id="linha3">
            <div class="col-6" >
                <strong class="word1">Sexo:</strong>
                <div class="word1">
                  <input type="radio" name="sexo" value="masculino" checked id="txtsexom">
                  <label>Masculino</label>
                  <input type="radio" name="sexo" value="feminino"  id="txtsexof">
                  <label>Feminino</label>
                 </div>
            </div>
            <div class="col-6">
                
                    <div class="form-group">
                      <label class="word1"for="exampleFormControlFile1">Foto de Perfil</label>
                      <input type="file" class="form-control-file" id="txtfotodeperfil">
                    </div>
                
            </div>
        </div>
            <div class="">
                <label class="word1">Data de nascimento:</label>
                <input type="date" name="data" id="txtdatadenascimento" required />
            </div>
        </fieldset>
        
        <fieldset>
            <legend style="color: white;">Endereço:</legend>
        <div class="row" id="linha4">
            <div class="col-12">
                <label class ="word1"for="inputAddress">Endereço</label>
                <input type="text" class="form-control" id="txtendereco" placeholder="Rua dos Bobos, nº 0" onkeypress="$(this).mask('');" required>
              </div>
        </div>
        <div class="row" id="linha5">
            <div class="col-6">
              <label class="word1" for="validationTooltip03">Cidade</label>
              <input type="text" class="form-control" id="txtcidade" placeholder="Cidade" onkeydown="return /[a-z]/i.test(event.key)" required>
              <div class="invalid-tooltip">
                Por favor, informe uma cidade válida.
              </div>
            </div>
            <div class="col-6">
              <label class="word1"for="validationTooltip04">Estado</label>
              <select id="txtestado" class="form-control">
                <option selected>Selecione o estado</option>
                <option>Acre</option>
                <option>Alagoas</option>
                <option>Amapa</option>
                <option>Amazonas</option>
                <option>Bahia</option>
                <option>Ceará</option>
                <option>Distrito Federal</option>
                <option>Espírito Santo</option>
                <option>Goiás</option>
                <option>Maranhão</option>
                <option>Mato Grosso</option>
                <option>Mato Grosso do Sul</option>
                <option>Minas Gerais</option>
                <option>Pará</option>
                <option>Paraíba</option>
                <option>Paraná</option>
                <option>Pernambuco</option>
                <option>Piauí</option>
                <option>Rio de Janeiro</option>
                <option>Rio Grande do Norte</option>
                <option>Rio Grande do Sul</option>
                <option>Rondônia</option>
                <option>Roraima</option>
                <option>Santa Catarina</option>
                <option>São Paulo</option>
                <option>Sergipe</option>
                <option>Tocantins</option>
              </select>
              <div class="invalid-tooltip">
                Por favor, informe um estado válido.
              </div>
            </div>
        </div>
        <div class="row" id="linha7">
            <div class="col-6">
                <label class="word1" for="inputAddress2">Complemento</label>
                <input type="text" class="form-control" id="inputAddress2" placeholder="Apartamento, hotel, casa, etc." onkeydown="return /[a-z]/i.test(event.key)">
              </div>
              <div class="col-6">
                <label class="word1" for="inputAddress2">CEP</label>
                <input type="text" class="form-control" id="inputAddress2" id="CEP" placeholder="CEP" onkeypress="$(this).mask('00000-000');" required>
                <div class="valid-feedback">
                    Tudo certo!
                  </div>
            </div>
        </div>
        <br>
        <div class="mb-3">
            <button class="btn btn-success btn-lg" onclick="atualizar()">Gravar</button>
        </div>
        
    </div>
<script>
  window.onload = (event) => {
            const params = new URLSearchParams(window.location.search)
            const id = params.get('id');
            buscarLivro(id);
        }

    const atualizar = async function(){
    const email = document.getElementById("txtemail").value
    const primeironome = document.getElementById("txtprimeironome").value
    const sobrenome = document.getElementById("txtsobrenome").value
    const usuario = document.getElementById("txtusuario").value
    const telefone = document.getElementById("txttelefone").value
    const sexomasculino = document.getElementById("txtsexom").checked
    const sexofeminino = document.getElementById("txtsexof").checked
    const fotodeperfil = document.getElementById("txtfotodeperfil").value
    const endereco = document.getElementById("txtendereco").value
    const cidade = document.getElementById("txtcidade").value
    const estadoObj = document.getElementById("txtestado");
    const estado = estadoObj.options[estadoObj.selectedIndex].text;
    const datadenascimento = document.getElementById("txtdatadenascimento").value
    const area = document.getElementById("txtarea").value
    const oferta = document.getElementById("txtoferta").checked
  
  const dados = {
        "email": email,
        "primeironome": primeironome,
        "sobrenome": sobrenome,
        "usuario": usuario,
        "telefone": telefone,
        "sexomasculino": sexomasculino,
        "sexofeminino": sexofeminino,
        "fotodeperfil": fotodeperfil,
        "endereco": endereco,
        "cidade": cidade,
        "estado": estado,
        "datadenascimento": datadenascimento,
        "oferta": oferta,
        "area": area
    };
  const response = await fetch("http://localhost:3000/usuario/update/" + id, 
              { method: "PUT", body: JSON.stringify(dados), headers: {
                'Content-Type': 'application/json' }});
  const content = await response.json();
  if (response.status == 200){
    alert("Cadastro atualizado com sucesso!");
    location.reload();
  }
              
}
</script>
</body>
</html>